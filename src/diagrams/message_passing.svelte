<script>
    import * as grid from "../gbp/grid.js";

    let t = 0;
    let [means, stds, direct_mu, direct_stds] = grid.gen_beliefs();

    // ticker
    let interval = 282; // svg units for one interval
    let start = 24.5; // svg units for one interval

    // Plotting marginals
    let scale = 60;
    let xstart = 503;
    let ystart = 22;
    const frac_std = 0.7;

    let showHint = false;

	function handleMouseOver(e) {
        let group = e.composedPath().find((element) => element.classList[0] == "node_g");
        if (group.id == "hint-icon") {
            showHint = true;
        }
	}
	function handleMouseOut(e) {
        let group = e.composedPath().find((element) => element.classList[0] == "node_g");
        if (group.id == "hint-icon") {
            showHint = false;
        }
    }

</script>


<style>

    #iteration-slider {
        width: 100%;
    }

    #time-text {
        font-size: 25px;
    }

    #ticker {
        fill: #FFF500; 
        stroke: black; 
        stroke-width: 0.7;
    }

    .no-fill {
        fill: white;
    }

    .belief-mean {
        fill: var(--blue);
    }

    .belief-std {
        stroke: var(--blue);
        stroke-opacity: 0.4;
    }

    .marg-mean {
        fill: var(--green);
    }

    .marg-std {
        stroke: var(--green);
        stroke-opacity: 1.0;
        stroke-width: 1.5;
    }

    /* .hidden {
        display: none;
    } */

    /* #hint-icon {
        cursor: pointer;
    } */

</style>


<figure class="subgrid">
    <div id="wrapper" class="interactive-container">

        <input id="iteration-slider" type="range" min="0" max="10" bind:value={t} step="0.01"/>

        <svg width="682" height="199" viewBox="0 -4 682 195" fill="none" xmlns="http://www.w3.org/2000/svg">

            <g id="graph">
                <line id="Line 1" x1="118" y1="156.5" x2="213" y2="156.5" stroke="black"/>
                <circle class:no-fill={t%1 < 0.66} id="Ellipse 5" cx="104" cy="156" r="14.5" fill="#EC5147" stroke="#FF0000"/>
                <path id="Rectangle 5" d="M213.5 145.5H235.5V167.5H213.5V145.5Z" stroke="black"/>
                <line id="Line 2" x1="235" y1="156.5" x2="286" y2="156.5" stroke="black"/>
                <line id="Line 3" x1="38" y1="156.5" x2="89" y2="156.5" stroke="black"/>
            </g>

            <g id="timeline">
                <g id="Rectangle 6">
                    <path d="M24 60H118V74H24V60Z" fill="#00AACF"/>
                    <path d="M24 60H118V74H24V60Z" fill="#00AACF"/>
                    <path d="M24 60H118V74H24V60Z" fill="#00AACF"/>
                    <path d="M24 60H118V74H24V60Z" fill="#00AACF"/>
                </g>
                <g id="Rectangle 7">
                    <path d="M118 60H212V74H118V60Z" fill="#00A743"/>
                    <path d="M118 60H212V74H118V60Z" fill="#00A743"/>
                    <path d="M118 60H212V74H118V60Z" fill="#00A743"/>
                    <path d="M118 60H212V74H118V60Z" fill="#00A743"/>
                </g>
                <g id="Rectangle 8">
                    <path d="M212 60H306V74H212V60Z" fill="#EC5147"/>
                    <path d="M212 60H306V74H212V60Z" fill="#EC5147"/>
                    <path d="M212 60H306V74H212V60Z" fill="#EC5147"/>
                    <path d="M212 60H306V74H212V60Z" fill="#EC5147"/>
                </g>
                <path id="Arrow 1" d="M328.707 74.7071C329.098 74.3166 329.098 73.6834 328.707 73.2929L322.343 66.9289C321.953 66.5384 321.319 66.5384 320.929 66.9289C320.538 67.3195 320.538 67.9526 320.929 68.3431L326.586 74L320.929 79.6569C320.538 80.0474 320.538 80.6805 320.929 81.0711C321.319 81.4616 321.953 81.4616 322.343 81.0711L328.707 74.7071ZM10 75L328 75V73L10 73V75Z" fill="black"/>
                <line id="Line 4" x1="24.5" y1="27" x2="24.5" y2="81" stroke="black"/>
                <line id="Line 5" x1="306.5" y1="55" x2="306.5" y2="81" stroke="black"/>
                <polygon id="ticker" points="{start + (t%1)*interval},75.9074 {start + 8 + (t%1)*interval},96.4 {start - 8 + (t%1)*interval},96.4"/>
            </g>

            <g id="text">
                <path id="Factor to variable MP" d="M45.3907 32.702V37H44.1027V26.976H49.9547V28.208H45.3907V31.498H49.5067V32.702H45.3907ZM51.8577 34.9C51.8577 35.236 51.9977 35.516 52.2777 35.74C52.5671 35.964 52.9031 36.076 53.2857 36.076C53.8271 36.076 54.3077 35.8753 54.7277 35.474C55.1571 35.0727 55.3717 34.6013 55.3717 34.06C54.9704 33.7427 54.4104 33.584 53.6917 33.584C53.1691 33.584 52.7304 33.71 52.3757 33.962C52.0304 34.214 51.8577 34.5267 51.8577 34.9ZM53.5237 29.916C54.4757 29.916 55.2271 30.1727 55.7777 30.686C56.3284 31.19 56.6037 31.8853 56.6037 32.772V37H55.3717V36.048H55.3157C54.7837 36.832 54.0744 37.224 53.1877 37.224C52.4317 37.224 51.7971 37 51.2837 36.552C50.7797 36.104 50.5277 35.544 50.5277 34.872C50.5277 34.1627 50.7937 33.598 51.3257 33.178C51.8671 32.758 52.5857 32.548 53.4817 32.548C54.2471 32.548 54.8771 32.688 55.3717 32.968V32.674C55.3717 32.226 55.1944 31.848 54.8397 31.54C54.4851 31.2227 54.0697 31.064 53.5937 31.064C52.8751 31.064 52.3057 31.3673 51.8857 31.974L50.7517 31.26C51.3771 30.364 52.3011 29.916 53.5237 29.916ZM61.1241 37.224C60.1068 37.224 59.2621 36.8787 58.5901 36.188C57.9274 35.4787 57.5961 34.606 57.5961 33.57C57.5961 32.5153 57.9274 31.6427 58.5901 30.952C59.2621 30.2613 60.1068 29.916 61.1241 29.916C61.8241 29.916 62.4354 30.0933 62.9581 30.448C63.4808 30.7933 63.8728 31.274 64.1341 31.89L62.9581 32.38C62.5941 31.5213 61.9548 31.092 61.0401 31.092C60.4521 31.092 59.9434 31.33 59.5141 31.806C59.0941 32.282 58.8841 32.87 58.8841 33.57C58.8841 34.27 59.0941 34.858 59.5141 35.334C59.9434 35.81 60.4521 36.048 61.0401 36.048C61.9828 36.048 62.6454 35.6187 63.0281 34.76L64.1761 35.25C63.9241 35.866 63.5274 36.3513 62.9861 36.706C62.4541 37.0513 61.8334 37.224 61.1241 37.224ZM67.9502 37.112C67.3902 37.112 66.9235 36.9393 66.5502 36.594C66.1862 36.2487 65.9995 35.768 65.9902 35.152V31.316H64.7862V30.14H65.9902V28.04H67.2782V30.14H68.9582V31.316H67.2782V34.732C67.2782 35.1893 67.3669 35.502 67.5442 35.67C67.7215 35.8287 67.9222 35.908 68.1462 35.908C68.2489 35.908 68.3469 35.8987 68.4402 35.88C68.5429 35.852 68.6362 35.8193 68.7202 35.782L69.1262 36.93C68.7902 37.0513 68.3982 37.112 67.9502 37.112ZM69.7231 33.57C69.7231 32.5153 70.0544 31.6427 70.7171 30.952C71.3891 30.2613 72.2337 29.916 73.2511 29.916C74.2684 29.916 75.1084 30.2613 75.7711 30.952C76.4431 31.6427 76.7791 32.5153 76.7791 33.57C76.7791 34.634 76.4431 35.5067 75.7711 36.188C75.1084 36.8787 74.2684 37.224 73.2511 37.224C72.2337 37.224 71.3891 36.8787 70.7171 36.188C70.0544 35.4973 69.7231 34.6247 69.7231 33.57ZM71.0111 33.57C71.0111 34.3073 71.2257 34.9047 71.6551 35.362C72.0844 35.8193 72.6164 36.048 73.2511 36.048C73.8857 36.048 74.4177 35.8193 74.8471 35.362C75.2764 34.9047 75.4911 34.3073 75.4911 33.57C75.4911 32.842 75.2764 32.2493 74.8471 31.792C74.4084 31.3253 73.8764 31.092 73.2511 31.092C72.6257 31.092 72.0937 31.3253 71.6551 31.792C71.2257 32.2493 71.0111 32.842 71.0111 33.57ZM79.1003 37H77.8123V30.14H79.0443V31.26H79.1003C79.231 30.896 79.497 30.588 79.8983 30.336C80.309 30.0747 80.7103 29.944 81.1023 29.944C81.4757 29.944 81.793 30 82.0543 30.112L81.6623 31.358C81.5037 31.2927 81.2517 31.26 80.9063 31.26C80.421 31.26 79.9963 31.456 79.6323 31.848C79.2777 32.24 79.1003 32.6973 79.1003 33.22V37ZM88.6904 37.112C88.1304 37.112 87.6638 36.9393 87.2904 36.594C86.9264 36.2487 86.7398 35.768 86.7304 35.152V31.316H85.5264V30.14H86.7304V28.04H88.0184V30.14H89.6984V31.316H88.0184V34.732C88.0184 35.1893 88.1071 35.502 88.2844 35.67C88.4618 35.8287 88.6624 35.908 88.8864 35.908C88.9891 35.908 89.0871 35.8987 89.1804 35.88C89.2831 35.852 89.3764 35.8193 89.4604 35.782L89.8664 36.93C89.5304 37.0513 89.1384 37.112 88.6904 37.112ZM90.4633 33.57C90.4633 32.5153 90.7946 31.6427 91.4573 30.952C92.1293 30.2613 92.974 29.916 93.9913 29.916C95.0086 29.916 95.8486 30.2613 96.5113 30.952C97.1833 31.6427 97.5193 32.5153 97.5193 33.57C97.5193 34.634 97.1833 35.5067 96.5113 36.188C95.8486 36.8787 95.0086 37.224 93.9913 37.224C92.974 37.224 92.1293 36.8787 91.4573 36.188C90.7946 35.4973 90.4633 34.6247 90.4633 33.57ZM91.7513 33.57C91.7513 34.3073 91.966 34.9047 92.3953 35.362C92.8246 35.8193 93.3566 36.048 93.9913 36.048C94.626 36.048 95.158 35.8193 95.5873 35.362C96.0166 34.9047 96.2313 34.3073 96.2313 33.57C96.2313 32.842 96.0166 32.2493 95.5873 31.792C95.1486 31.3253 94.6166 31.092 93.9913 31.092C93.366 31.092 92.834 31.3253 92.3953 31.792C91.966 32.2493 91.7513 32.842 91.7513 33.57ZM39.5681 54H38.2801L35.5081 47.14H36.9081L38.9241 52.46H38.9521L40.9961 47.14H42.3681L39.5681 54ZM44.0101 51.9C44.0101 52.236 44.1501 52.516 44.4301 52.74C44.7194 52.964 45.0554 53.076 45.4381 53.076C45.9794 53.076 46.4601 52.8753 46.8801 52.474C47.3094 52.0727 47.5241 51.6013 47.5241 51.06C47.1228 50.7427 46.5628 50.584 45.8441 50.584C45.3214 50.584 44.8828 50.71 44.5281 50.962C44.1828 51.214 44.0101 51.5267 44.0101 51.9ZM45.6761 46.916C46.6281 46.916 47.3794 47.1727 47.9301 47.686C48.4808 48.19 48.7561 48.8853 48.7561 49.772V54H47.5241V53.048H47.4681C46.9361 53.832 46.2268 54.224 45.3401 54.224C44.5841 54.224 43.9494 54 43.4361 53.552C42.9321 53.104 42.6801 52.544 42.6801 51.872C42.6801 51.1627 42.9461 50.598 43.4781 50.178C44.0194 49.758 44.7381 49.548 45.6341 49.548C46.3994 49.548 47.0294 49.688 47.5241 49.968V49.674C47.5241 49.226 47.3468 48.848 46.9921 48.54C46.6374 48.2227 46.2221 48.064 45.7461 48.064C45.0274 48.064 44.4581 48.3673 44.0381 48.974L42.9041 48.26C43.5294 47.364 44.4534 46.916 45.6761 46.916ZM51.4968 54H50.2088V47.14H51.4408V48.26H51.4968C51.6275 47.896 51.8935 47.588 52.2948 47.336C52.7055 47.0747 53.1068 46.944 53.4988 46.944C53.8721 46.944 54.1895 47 54.4508 47.112L54.0588 48.358C53.9001 48.2927 53.6481 48.26 53.3028 48.26C52.8175 48.26 52.3928 48.456 52.0288 48.848C51.6741 49.24 51.4968 49.6973 51.4968 50.22V54ZM56.9607 44.774C56.9607 45.026 56.8721 45.2407 56.6947 45.418C56.5174 45.5953 56.3027 45.684 56.0507 45.684C55.7987 45.684 55.5841 45.5953 55.4067 45.418C55.2294 45.2407 55.1407 45.026 55.1407 44.774C55.1407 44.522 55.2294 44.3073 55.4067 44.13C55.5841 43.9527 55.7987 43.864 56.0507 43.864C56.3027 43.864 56.5174 43.9527 56.6947 44.13C56.8721 44.3073 56.9607 44.522 56.9607 44.774ZM56.6947 47.14V54H55.4067V47.14H56.6947ZM59.2406 51.9C59.2406 52.236 59.3806 52.516 59.6606 52.74C59.9499 52.964 60.2859 53.076 60.6686 53.076C61.2099 53.076 61.6906 52.8753 62.1106 52.474C62.5399 52.0727 62.7546 51.6013 62.7546 51.06C62.3532 50.7427 61.7932 50.584 61.0746 50.584C60.5519 50.584 60.1132 50.71 59.7586 50.962C59.4132 51.214 59.2406 51.5267 59.2406 51.9ZM60.9066 46.916C61.8586 46.916 62.6099 47.1727 63.1606 47.686C63.7112 48.19 63.9866 48.8853 63.9866 49.772V54H62.7546V53.048H62.6986C62.1666 53.832 61.4572 54.224 60.5706 54.224C59.8146 54.224 59.1799 54 58.6666 53.552C58.1626 53.104 57.9106 52.544 57.9106 51.872C57.9106 51.1627 58.1766 50.598 58.7086 50.178C59.2499 49.758 59.9686 49.548 60.8646 49.548C61.6299 49.548 62.2599 49.688 62.7546 49.968V49.674C62.7546 49.226 62.5772 48.848 62.2226 48.54C61.8679 48.2227 61.4526 48.064 60.9766 48.064C60.2579 48.064 59.6886 48.3673 59.2686 48.974L58.1346 48.26C58.7599 47.364 59.6839 46.916 60.9066 46.916ZM69.0653 54.224C68.5613 54.224 68.0993 54.1167 67.6793 53.902C67.2686 53.6873 66.9513 53.4027 66.7273 53.048H66.6713V54H65.4393V43.976H66.7273V47.14L66.6713 48.092H66.7273C66.9513 47.7373 67.2686 47.4527 67.6793 47.238C68.0993 47.0233 68.5613 46.916 69.0653 46.916C69.9706 46.916 70.7359 47.2707 71.3613 47.98C72.0053 48.6987 72.3273 49.562 72.3273 50.57C72.3273 51.5873 72.0053 52.4507 71.3613 53.16C70.7359 53.8693 69.9706 54.224 69.0653 54.224ZM68.8553 53.048C69.4713 53.048 69.9893 52.8147 70.4093 52.348C70.8293 51.8907 71.0393 51.298 71.0393 50.57C71.0393 49.8513 70.8293 49.2587 70.4093 48.792C69.9893 48.3253 69.4713 48.092 68.8553 48.092C68.2299 48.092 67.7073 48.3253 67.2873 48.792C66.8766 49.2587 66.6713 49.8513 66.6713 50.57C66.6713 51.298 66.8766 51.8953 67.2873 52.362C67.7073 52.8193 68.2299 53.048 68.8553 53.048ZM74.7253 43.976V54H73.4373V43.976H74.7253ZM79.3064 54.224C78.2984 54.224 77.4677 53.8787 76.8144 53.188C76.161 52.4973 75.8344 51.6247 75.8344 50.57C75.8344 49.5247 76.1517 48.6567 76.7864 47.966C77.421 47.266 78.233 46.916 79.2224 46.916C80.2397 46.916 81.047 47.2473 81.6444 47.91C82.251 48.5633 82.5544 49.4827 82.5544 50.668L82.5404 50.808H77.1504C77.169 51.48 77.393 52.0213 77.8224 52.432C78.2517 52.8427 78.765 53.048 79.3624 53.048C80.1837 53.048 80.8277 52.6373 81.2944 51.816L82.4424 52.376C82.1344 52.9547 81.705 53.4073 81.1544 53.734C80.613 54.0607 79.997 54.224 79.3064 54.224ZM77.2484 49.744H81.1824C81.145 49.268 80.949 48.876 80.5944 48.568C80.249 48.2507 79.7824 48.092 79.1944 48.092C78.709 48.092 78.289 48.2413 77.9344 48.54C77.589 48.8387 77.3604 49.24 77.2484 49.744ZM88.3204 54H87.0324V43.976H88.3204L91.8064 50.08H91.8624L95.3484 43.976H96.6364V54H95.3484V48.05L95.4044 46.37H95.3484L92.2124 51.872H91.4564L88.3204 46.37H88.2644L88.3204 48.05V54ZM99.9415 49.94V54H98.6535V43.976H102.07C102.938 43.976 103.675 44.2653 104.282 44.844C104.898 45.4227 105.206 46.1273 105.206 46.958C105.206 47.8073 104.898 48.5167 104.282 49.086C103.684 49.6553 102.947 49.94 102.07 49.94H99.9415ZM99.9415 45.208V48.708H102.098C102.611 48.708 103.036 48.5353 103.372 48.19C103.717 47.8447 103.89 47.434 103.89 46.958C103.89 46.4913 103.717 46.0853 103.372 45.74C103.036 45.3853 102.611 45.208 102.098 45.208H99.9415Z" fill="#00AACF"/>
                <path id="Variable to factor MP" d="M138.24 37H136.896L133.368 26.976H134.796L137.54 35.11H137.596L140.452 26.976H141.88L138.24 37ZM143.071 34.9C143.071 35.236 143.211 35.516 143.491 35.74C143.78 35.964 144.116 36.076 144.499 36.076C145.04 36.076 145.521 35.8753 145.941 35.474C146.37 35.0727 146.585 34.6013 146.585 34.06C146.183 33.7427 145.623 33.584 144.905 33.584C144.382 33.584 143.943 33.71 143.589 33.962C143.243 34.214 143.071 34.5267 143.071 34.9ZM144.737 29.916C145.689 29.916 146.44 30.1727 146.991 30.686C147.541 31.19 147.817 31.8853 147.817 32.772V37H146.585V36.048H146.529C145.997 36.832 145.287 37.224 144.401 37.224C143.645 37.224 143.01 37 142.497 36.552C141.993 36.104 141.741 35.544 141.741 34.872C141.741 34.1627 142.007 33.598 142.539 33.178C143.08 32.758 143.799 32.548 144.695 32.548C145.46 32.548 146.09 32.688 146.585 32.968V32.674C146.585 32.226 146.407 31.848 146.053 31.54C145.698 31.2227 145.283 31.064 144.807 31.064C144.088 31.064 143.519 31.3673 143.099 31.974L141.965 31.26C142.59 30.364 143.514 29.916 144.737 29.916ZM150.557 37H149.269V30.14H150.501V31.26H150.557C150.688 30.896 150.954 30.588 151.355 30.336C151.766 30.0747 152.167 29.944 152.559 29.944C152.933 29.944 153.25 30 153.511 30.112L153.119 31.358C152.961 31.2927 152.709 31.26 152.363 31.26C151.878 31.26 151.453 31.456 151.089 31.848C150.735 32.24 150.557 32.6973 150.557 33.22V37ZM156.021 27.774C156.021 28.026 155.933 28.2407 155.755 28.418C155.578 28.5953 155.363 28.684 155.111 28.684C154.859 28.684 154.645 28.5953 154.467 28.418C154.29 28.2407 154.201 28.026 154.201 27.774C154.201 27.522 154.29 27.3073 154.467 27.13C154.645 26.9527 154.859 26.864 155.111 26.864C155.363 26.864 155.578 26.9527 155.755 27.13C155.933 27.3073 156.021 27.522 156.021 27.774ZM155.755 30.14V37H154.467V30.14H155.755ZM158.301 34.9C158.301 35.236 158.441 35.516 158.721 35.74C159.01 35.964 159.346 36.076 159.729 36.076C160.27 36.076 160.751 35.8753 161.171 35.474C161.6 35.0727 161.815 34.6013 161.815 34.06C161.414 33.7427 160.854 33.584 160.135 33.584C159.612 33.584 159.174 33.71 158.819 33.962C158.474 34.214 158.301 34.5267 158.301 34.9ZM159.967 29.916C160.919 29.916 161.67 30.1727 162.221 30.686C162.772 31.19 163.047 31.8853 163.047 32.772V37H161.815V36.048H161.759C161.227 36.832 160.518 37.224 159.631 37.224C158.875 37.224 158.24 37 157.727 36.552C157.223 36.104 156.971 35.544 156.971 34.872C156.971 34.1627 157.237 33.598 157.769 33.178C158.31 32.758 159.029 32.548 159.925 32.548C160.69 32.548 161.32 32.688 161.815 32.968V32.674C161.815 32.226 161.638 31.848 161.283 31.54C160.928 31.2227 160.513 31.064 160.037 31.064C159.318 31.064 158.749 31.3673 158.329 31.974L157.195 31.26C157.82 30.364 158.744 29.916 159.967 29.916ZM168.126 37.224C167.622 37.224 167.16 37.1167 166.74 36.902C166.329 36.6873 166.012 36.4027 165.788 36.048H165.732V37H164.5V26.976H165.788V30.14L165.732 31.092H165.788C166.012 30.7373 166.329 30.4527 166.74 30.238C167.16 30.0233 167.622 29.916 168.126 29.916C169.031 29.916 169.796 30.2707 170.422 30.98C171.066 31.6987 171.388 32.562 171.388 33.57C171.388 34.5873 171.066 35.4507 170.422 36.16C169.796 36.8693 169.031 37.224 168.126 37.224ZM167.916 36.048C168.532 36.048 169.05 35.8147 169.47 35.348C169.89 34.8907 170.1 34.298 170.1 33.57C170.1 32.8513 169.89 32.2587 169.47 31.792C169.05 31.3253 168.532 31.092 167.916 31.092C167.29 31.092 166.768 31.3253 166.348 31.792C165.937 32.2587 165.732 32.8513 165.732 33.57C165.732 34.298 165.937 34.8953 166.348 35.362C166.768 35.8193 167.29 36.048 167.916 36.048ZM173.786 26.976V37H172.498V26.976H173.786ZM178.367 37.224C177.359 37.224 176.528 36.8787 175.875 36.188C175.222 35.4973 174.895 34.6247 174.895 33.57C174.895 32.5247 175.212 31.6567 175.847 30.966C176.482 30.266 177.294 29.916 178.283 29.916C179.3 29.916 180.108 30.2473 180.705 30.91C181.312 31.5633 181.615 32.4827 181.615 33.668L181.601 33.808H176.211C176.23 34.48 176.454 35.0213 176.883 35.432C177.312 35.8427 177.826 36.048 178.423 36.048C179.244 36.048 179.888 35.6373 180.355 34.816L181.503 35.376C181.195 35.9547 180.766 36.4073 180.215 36.734C179.674 37.0607 179.058 37.224 178.367 37.224ZM176.309 32.744H180.243C180.206 32.268 180.01 31.876 179.655 31.568C179.31 31.2507 178.843 31.092 178.255 31.092C177.77 31.092 177.35 31.2413 176.995 31.54C176.65 31.8387 176.421 32.24 176.309 32.744ZM188.585 37.112C188.025 37.112 187.558 36.9393 187.185 36.594C186.821 36.2487 186.634 35.768 186.625 35.152V31.316H185.421V30.14H186.625V28.04H187.913V30.14H189.593V31.316H187.913V34.732C187.913 35.1893 188.002 35.502 188.179 35.67C188.356 35.8287 188.557 35.908 188.781 35.908C188.884 35.908 188.982 35.8987 189.075 35.88C189.178 35.852 189.271 35.8193 189.355 35.782L189.761 36.93C189.425 37.0513 189.033 37.112 188.585 37.112ZM190.358 33.57C190.358 32.5153 190.689 31.6427 191.352 30.952C192.024 30.2613 192.868 29.916 193.886 29.916C194.903 29.916 195.743 30.2613 196.406 30.952C197.078 31.6427 197.414 32.5153 197.414 33.57C197.414 34.634 197.078 35.5067 196.406 36.188C195.743 36.8787 194.903 37.224 193.886 37.224C192.868 37.224 192.024 36.8787 191.352 36.188C190.689 35.4973 190.358 34.6247 190.358 33.57ZM191.646 33.57C191.646 34.3073 191.86 34.9047 192.29 35.362C192.719 35.8193 193.251 36.048 193.886 36.048C194.52 36.048 195.052 35.8193 195.482 35.362C195.911 34.9047 196.126 34.3073 196.126 33.57C196.126 32.842 195.911 32.2493 195.482 31.792C195.043 31.3253 194.511 31.092 193.886 31.092C193.26 31.092 192.728 31.3253 192.29 31.792C191.86 32.2493 191.646 32.842 191.646 33.57ZM139.719 43.864C140.185 43.864 140.568 43.9433 140.867 44.102L140.517 45.236C140.293 45.124 140.041 45.068 139.761 45.068C139.443 45.068 139.182 45.18 138.977 45.404C138.781 45.6187 138.683 45.908 138.683 46.272V47.14H140.475V48.316H138.683V54H137.395V48.316H136.107V47.14H137.395V46.146C137.395 45.4647 137.609 44.914 138.039 44.494C138.477 44.074 139.037 43.864 139.719 43.864ZM142.373 51.9C142.373 52.236 142.513 52.516 142.793 52.74C143.083 52.964 143.419 53.076 143.801 53.076C144.343 53.076 144.823 52.8753 145.243 52.474C145.673 52.0727 145.887 51.6013 145.887 51.06C145.486 50.7427 144.926 50.584 144.207 50.584C143.685 50.584 143.246 50.71 142.891 50.962C142.546 51.214 142.373 51.5267 142.373 51.9ZM144.039 46.916C144.991 46.916 145.743 47.1727 146.293 47.686C146.844 48.19 147.119 48.8853 147.119 49.772V54H145.887V53.048H145.831C145.299 53.832 144.59 54.224 143.703 54.224C142.947 54.224 142.313 54 141.799 53.552C141.295 53.104 141.043 52.544 141.043 51.872C141.043 51.1627 141.309 50.598 141.841 50.178C142.383 49.758 143.101 49.548 143.997 49.548C144.763 49.548 145.393 49.688 145.887 49.968V49.674C145.887 49.226 145.71 48.848 145.355 48.54C145.001 48.2227 144.585 48.064 144.109 48.064C143.391 48.064 142.821 48.3673 142.401 48.974L141.267 48.26C141.893 47.364 142.817 46.916 144.039 46.916ZM151.64 54.224C150.622 54.224 149.778 53.8787 149.106 53.188C148.443 52.4787 148.112 51.606 148.112 50.57C148.112 49.5153 148.443 48.6427 149.106 47.952C149.778 47.2613 150.622 46.916 151.64 46.916C152.34 46.916 152.951 47.0933 153.474 47.448C153.996 47.7933 154.388 48.274 154.65 48.89L153.474 49.38C153.11 48.5213 152.47 48.092 151.556 48.092C150.968 48.092 150.459 48.33 150.03 48.806C149.61 49.282 149.4 49.87 149.4 50.57C149.4 51.27 149.61 51.858 150.03 52.334C150.459 52.81 150.968 53.048 151.556 53.048C152.498 53.048 153.161 52.6187 153.544 51.76L154.692 52.25C154.44 52.866 154.043 53.3513 153.502 53.706C152.97 54.0513 152.349 54.224 151.64 54.224ZM158.466 54.112C157.906 54.112 157.439 53.9393 157.066 53.594C156.702 53.2487 156.515 52.768 156.506 52.152V48.316H155.302V47.14H156.506V45.04H157.794V47.14H159.474V48.316H157.794V51.732C157.794 52.1893 157.882 52.502 158.06 52.67C158.237 52.8287 158.438 52.908 158.662 52.908C158.764 52.908 158.862 52.8987 158.956 52.88C159.058 52.852 159.152 52.8193 159.236 52.782L159.642 53.93C159.306 54.0513 158.914 54.112 158.466 54.112ZM160.239 50.57C160.239 49.5153 160.57 48.6427 161.233 47.952C161.905 47.2613 162.749 46.916 163.767 46.916C164.784 46.916 165.624 47.2613 166.287 47.952C166.959 48.6427 167.295 49.5153 167.295 50.57C167.295 51.634 166.959 52.5067 166.287 53.188C165.624 53.8787 164.784 54.224 163.767 54.224C162.749 54.224 161.905 53.8787 161.233 53.188C160.57 52.4973 160.239 51.6247 160.239 50.57ZM161.527 50.57C161.527 51.3073 161.741 51.9047 162.171 52.362C162.6 52.8193 163.132 53.048 163.767 53.048C164.401 53.048 164.933 52.8193 165.363 52.362C165.792 51.9047 166.007 51.3073 166.007 50.57C166.007 49.842 165.792 49.2493 165.363 48.792C164.924 48.3253 164.392 48.092 163.767 48.092C163.141 48.092 162.609 48.3253 162.171 48.792C161.741 49.2493 161.527 49.842 161.527 50.57ZM169.616 54H168.328V47.14H169.56V48.26H169.616C169.747 47.896 170.013 47.588 170.414 47.336C170.825 47.0747 171.226 46.944 171.618 46.944C171.991 46.944 172.309 47 172.57 47.112L172.178 48.358C172.019 48.2927 171.767 48.26 171.422 48.26C170.937 48.26 170.512 48.456 170.148 48.848C169.793 49.24 169.616 49.6973 169.616 50.22V54ZM178.002 54H176.714V43.976H178.002L181.488 50.08H181.544L185.03 43.976H186.318V54H185.03V48.05L185.086 46.37H185.03L181.894 51.872H181.138L178.002 46.37H177.946L178.002 48.05V54ZM189.623 49.94V54H188.335V43.976H191.751C192.619 43.976 193.356 44.2653 193.963 44.844C194.579 45.4227 194.887 46.1273 194.887 46.958C194.887 47.8073 194.579 48.5167 193.963 49.086C193.366 49.6553 192.628 49.94 191.751 49.94H189.623ZM189.623 45.208V48.708H191.779C192.292 48.708 192.717 48.5353 193.053 48.19C193.398 47.8447 193.571 47.434 193.571 46.958C193.571 46.4913 193.398 46.0853 193.053 45.74C192.717 45.3853 192.292 45.208 191.779 45.208H189.623Z" fill="#00A743"/>
                <path id="Belief update" d="M221.374 47V36.976H225C225.794 36.976 226.475 37.2373 227.044 37.76C227.614 38.2733 227.898 38.922 227.898 39.706C227.898 40.6953 227.446 41.3907 226.54 41.792V41.848C227.054 42.016 227.464 42.31 227.772 42.73C228.08 43.1407 228.234 43.612 228.234 44.144C228.234 44.9653 227.936 45.6467 227.338 46.188C226.76 46.7293 226.046 47 225.196 47H221.374ZM222.662 38.208V41.274H225C225.458 41.274 225.84 41.12 226.148 40.812C226.456 40.4947 226.61 40.1353 226.61 39.734C226.61 39.342 226.461 38.9873 226.162 38.67C225.864 38.362 225.495 38.208 225.056 38.208H222.662ZM222.662 42.478V45.768H225.252C225.719 45.768 226.116 45.6047 226.442 45.278C226.76 44.9513 226.918 44.564 226.918 44.116C226.918 43.6773 226.755 43.2947 226.428 42.968C226.102 42.6413 225.691 42.478 225.196 42.478H222.662ZM232.543 47.224C231.535 47.224 230.704 46.8787 230.051 46.188C229.397 45.4973 229.071 44.6247 229.071 43.57C229.071 42.5247 229.388 41.6567 230.023 40.966C230.657 40.266 231.469 39.916 232.459 39.916C233.476 39.916 234.283 40.2473 234.881 40.91C235.487 41.5633 235.791 42.4827 235.791 43.668L235.777 43.808H230.387C230.405 44.48 230.629 45.0213 231.059 45.432C231.488 45.8427 232.001 46.048 232.599 46.048C233.42 46.048 234.064 45.6373 234.531 44.816L235.679 45.376C235.371 45.9547 234.941 46.4073 234.391 46.734C233.849 47.0607 233.233 47.224 232.543 47.224ZM230.485 42.744H234.419C234.381 42.268 234.185 41.876 233.831 41.568C233.485 41.2507 233.019 41.092 232.431 41.092C231.945 41.092 231.525 41.2413 231.171 41.54C230.825 41.8387 230.597 42.24 230.485 42.744ZM238.257 36.976V47H236.969V36.976H238.257ZM241.492 37.774C241.492 38.026 241.403 38.2407 241.226 38.418C241.049 38.5953 240.834 38.684 240.582 38.684C240.33 38.684 240.115 38.5953 239.938 38.418C239.761 38.2407 239.672 38.026 239.672 37.774C239.672 37.522 239.761 37.3073 239.938 37.13C240.115 36.9527 240.33 36.864 240.582 36.864C240.834 36.864 241.049 36.9527 241.226 37.13C241.403 37.3073 241.492 37.522 241.492 37.774ZM241.226 40.14V47H239.938V40.14H241.226ZM245.914 47.224C244.906 47.224 244.075 46.8787 243.422 46.188C242.768 45.4973 242.442 44.6247 242.442 43.57C242.442 42.5247 242.759 41.6567 243.394 40.966C244.028 40.266 244.84 39.916 245.83 39.916C246.847 39.916 247.654 40.2473 248.252 40.91C248.858 41.5633 249.162 42.4827 249.162 43.668L249.148 43.808H243.758C243.776 44.48 244 45.0213 244.43 45.432C244.859 45.8427 245.372 46.048 245.97 46.048C246.791 46.048 247.435 45.6373 247.902 44.816L249.05 45.376C248.742 45.9547 248.312 46.4073 247.762 46.734C247.22 47.0607 246.604 47.224 245.914 47.224ZM243.856 42.744H247.79C247.752 42.268 247.556 41.876 247.202 41.568C246.856 41.2507 246.39 41.092 245.802 41.092C245.316 41.092 244.896 41.2413 244.542 41.54C244.196 41.8387 243.968 42.24 243.856 42.744ZM253.367 36.864C253.834 36.864 254.216 36.9433 254.515 37.102L254.165 38.236C253.941 38.124 253.689 38.068 253.409 38.068C253.092 38.068 252.83 38.18 252.625 38.404C252.429 38.6187 252.331 38.908 252.331 39.272V40.14H254.123V41.316H252.331V47H251.043V41.316H249.755V40.14H251.043V39.146C251.043 38.4647 251.258 37.914 251.687 37.494C252.126 37.074 252.686 36.864 253.367 36.864ZM264.453 47H263.221V46.048H263.165C262.969 46.384 262.666 46.664 262.255 46.888C261.854 47.112 261.434 47.224 260.995 47.224C260.155 47.224 259.507 46.986 259.049 46.51C258.601 46.0247 258.377 45.3387 258.377 44.452V40.14H259.665V44.368C259.693 45.488 260.258 46.048 261.359 46.048C261.873 46.048 262.302 45.8427 262.647 45.432C262.993 45.012 263.165 44.5127 263.165 43.934V40.14H264.453V47ZM269.381 46.048C269.997 46.048 270.515 45.8147 270.935 45.348C271.355 44.8907 271.565 44.298 271.565 43.57C271.565 42.8513 271.355 42.2587 270.935 41.792C270.515 41.3253 269.997 41.092 269.381 41.092C268.756 41.092 268.233 41.3253 267.813 41.792C267.403 42.2587 267.197 42.8513 267.197 43.57C267.197 44.298 267.403 44.8953 267.813 45.362C268.233 45.8193 268.756 46.048 269.381 46.048ZM269.591 47.224C269.087 47.224 268.625 47.1167 268.205 46.902C267.795 46.6873 267.477 46.4027 267.253 46.048H267.197L267.253 47V50.024H265.965V40.14H267.197V41.092H267.253C267.477 40.7373 267.795 40.4527 268.205 40.238C268.625 40.0233 269.087 39.916 269.591 39.916C270.497 39.916 271.262 40.2707 271.887 40.98C272.531 41.6987 272.853 42.562 272.853 43.57C272.853 44.5873 272.531 45.4507 271.887 46.16C271.262 46.8693 270.497 47.224 269.591 47.224ZM277.113 46.048C277.748 46.048 278.266 45.8193 278.667 45.362C279.087 44.9047 279.297 44.3073 279.297 43.57C279.297 42.8513 279.087 42.2587 278.667 41.792C278.256 41.3253 277.738 41.092 277.113 41.092C276.497 41.092 275.979 41.3253 275.559 41.792C275.139 42.2587 274.929 42.8513 274.929 43.57C274.929 44.298 275.139 44.8907 275.559 45.348C275.979 45.8147 276.497 46.048 277.113 46.048ZM276.903 47.224C276.007 47.224 275.237 46.8693 274.593 46.16C273.958 45.4413 273.641 44.578 273.641 43.57C273.641 42.562 273.958 41.6987 274.593 40.98C275.237 40.2707 276.007 39.916 276.903 39.916C277.407 39.916 277.864 40.0233 278.275 40.238C278.695 40.4527 279.017 40.7373 279.241 41.092H279.297L279.241 40.14V36.976H280.529V47H279.297V46.048H279.241C279.017 46.4027 278.695 46.6873 278.275 46.902C277.864 47.1167 277.407 47.224 276.903 47.224ZM282.969 44.9C282.969 45.236 283.109 45.516 283.389 45.74C283.678 45.964 284.014 46.076 284.397 46.076C284.938 46.076 285.419 45.8753 285.839 45.474C286.268 45.0727 286.483 44.6013 286.483 44.06C286.082 43.7427 285.522 43.584 284.803 43.584C284.28 43.584 283.842 43.71 283.487 43.962C283.142 44.214 282.969 44.5267 282.969 44.9ZM284.635 39.916C285.587 39.916 286.338 40.1727 286.889 40.686C287.44 41.19 287.715 41.8853 287.715 42.772V47H286.483V46.048H286.427C285.895 46.832 285.186 47.224 284.299 47.224C283.543 47.224 282.908 47 282.395 46.552C281.891 46.104 281.639 45.544 281.639 44.872C281.639 44.1627 281.905 43.598 282.437 43.178C282.978 42.758 283.697 42.548 284.593 42.548C285.358 42.548 285.988 42.688 286.483 42.968V42.674C286.483 42.226 286.306 41.848 285.951 41.54C285.596 41.2227 285.181 41.064 284.705 41.064C283.986 41.064 283.417 41.3673 282.997 41.974L281.863 41.26C282.488 40.364 283.412 39.916 284.635 39.916ZM291.747 47.112C291.187 47.112 290.72 46.9393 290.347 46.594C289.983 46.2487 289.796 45.768 289.787 45.152V41.316H288.583V40.14H289.787V38.04H291.075V40.14H292.755V41.316H291.075V44.732C291.075 45.1893 291.164 45.502 291.341 45.67C291.518 45.8287 291.719 45.908 291.943 45.908C292.046 45.908 292.144 45.8987 292.237 45.88C292.34 45.852 292.433 45.8193 292.517 45.782L292.923 46.93C292.587 47.0513 292.195 47.112 291.747 47.112ZM296.992 47.224C295.984 47.224 295.153 46.8787 294.5 46.188C293.847 45.4973 293.52 44.6247 293.52 43.57C293.52 42.5247 293.837 41.6567 294.472 40.966C295.107 40.266 295.919 39.916 296.908 39.916C297.925 39.916 298.733 40.2473 299.33 40.91C299.937 41.5633 300.24 42.4827 300.24 43.668L300.226 43.808H294.836C294.855 44.48 295.079 45.0213 295.508 45.432C295.937 45.8427 296.451 46.048 297.048 46.048C297.869 46.048 298.513 45.6373 298.98 44.816L300.128 45.376C299.82 45.9547 299.391 46.4073 298.84 46.734C298.299 47.0607 297.683 47.224 296.992 47.224ZM294.934 42.744H298.868C298.831 42.268 298.635 41.876 298.28 41.568C297.935 41.2507 297.468 41.092 296.88 41.092C296.395 41.092 295.975 41.2413 295.62 41.54C295.275 41.8387 295.046 42.24 294.934 42.744Z" fill="#EC5147"/>
                <path id="t =" d="M8.61328 20.224C7.49328 20.224 6.55995 19.8787 5.81328 19.188C5.08528 18.4973 4.71195 17.536 4.69328 16.304V8.632H2.28528V6.28H4.69328V2.08H7.26928V6.28H10.6293V8.632H7.26928V15.464C7.26928 16.3787 7.44661 17.004 7.80128 17.34C8.15595 17.6573 8.55728 17.816 9.00528 17.816C9.21061 17.816 9.40661 17.7973 9.59328 17.76C9.79861 17.704 9.98528 17.6387 10.1533 17.564L10.9653 19.86C10.2933 20.1027 9.50928 20.224 8.61328 20.224ZM31.8321 9.472H19.2321V7.344H31.8321V9.472ZM31.8321 14.792H19.2321V12.664H31.8321V14.792Z" fill="black"/>
                <text id="time-text" x="45" y="20" fill="black">{Math.floor(t)}</text>
            </g>

            <g id="message arrows">
                {#if t%1 < 0.33}
                    <path id="Arrow 5" d="M123.939 140.939C123.354 141.525 123.354 142.475 123.939 143.061L133.485 152.607C134.071 153.192 135.021 153.192 135.607 152.607C136.192 152.021 136.192 151.071 135.607 150.485L127.121 142L135.607 133.515C136.192 132.929 136.192 131.979 135.607 131.393C135.021 130.808 134.071 130.808 133.485 131.393L123.939 140.939ZM199 140.5H125V143.5H199V140.5Z" fill="#00AACF"/>
                    <path id="Arrow 6" d="M82.0607 143.061C82.6464 142.475 82.6464 141.525 82.0607 140.939L72.5147 131.393C71.9289 130.808 70.9792 130.808 70.3934 131.393C69.8076 131.979 69.8076 132.929 70.3934 133.515L78.8787 142L70.3934 150.485C69.8076 151.071 69.8076 152.021 70.3934 152.607C70.9792 153.192 71.9289 153.192 72.5147 152.607L82.0607 143.061ZM30 143.5L81 143.5L81 140.5L30 140.5L30 143.5Z" fill="#00AACF"/>
                    <path id="Arrow 7" d="M301.061 143.061C301.646 142.475 301.646 141.525 301.061 140.939L291.515 131.393C290.929 130.808 289.979 130.808 289.393 131.393C288.808 131.979 288.808 132.929 289.393 133.515L297.879 142L289.393 150.485C288.808 151.071 288.808 152.021 289.393 152.607C289.979 153.192 290.929 153.192 291.515 152.607L301.061 143.061ZM249 143.5L300 143.5L300 140.5L249 140.5L249 143.5Z" fill="#00AACF"/>
                {:else if t%1 < 0.66}
                    <path id="Arrow 2" d="M200.061 172.061C200.646 171.475 200.646 170.525 200.061 169.939L190.515 160.393C189.929 159.808 188.979 159.808 188.393 160.393C187.808 160.979 187.808 161.929 188.393 162.515L196.879 171L188.393 179.485C187.808 180.071 187.808 181.021 188.393 181.607C188.979 182.192 189.929 182.192 190.515 181.607L200.061 172.061ZM125 172.5H199V169.5H125V172.5Z" fill="#00A743"/>
                    <path id="Arrow 3" d="M28.9393 169.939C28.3536 170.525 28.3536 171.475 28.9393 172.061L38.4853 181.607C39.0711 182.192 40.0208 182.192 40.6066 181.607C41.1924 181.021 41.1924 180.071 40.6066 179.485L32.1213 171L40.6066 162.515C41.1924 161.929 41.1924 160.979 40.6066 160.393C40.0208 159.808 39.0711 159.808 38.4853 160.393L28.9393 169.939ZM81 169.5H30V172.5H81V169.5Z" fill="#00A743"/>
                    <path id="Arrow 4" d="M247.939 169.939C247.354 170.525 247.354 171.475 247.939 172.061L257.485 181.607C258.071 182.192 259.021 182.192 259.607 181.607C260.192 181.021 260.192 180.071 259.607 179.485L251.121 171L259.607 162.515C260.192 161.929 260.192 160.979 259.607 160.393C259.021 159.808 258.071 159.808 257.485 160.393L247.939 169.939ZM300 169.5H249V172.5H300V169.5Z" fill="#00A743"/>
                {/if}
            </g>


            <g id="edges">
                {#each Array(3) as _, i}
                    {#each Array(3) as _, j}
                    {#if j < 2}
                        <line stroke="black"
                            x1={xstart + means[Math.floor(t)].xs[3*i + j]*scale} x2={xstart + means[Math.floor(t)].xs[3*i + j + 1]*scale}
                            y1={ystart + means[Math.floor(t)].ys[3*i + j]*scale} y2={ystart + means[Math.floor(t)].ys[3*i + j + 1]*scale} />
                    {/if}
                    {#if i < 2}
                        <line stroke="black"
                            x1={xstart + means[Math.floor(t)].xs[3*i + j]*scale} x2={xstart + means[Math.floor(t)].xs[3*i + j + 3]*scale}
                            y1={ystart + means[Math.floor(t)].ys[3*i + j]*scale} y2={ystart + means[Math.floor(t)].ys[3*i + j + 3]*scale} />
                    {/if}
                    {/each}
                {/each}
            </g>

            <g id="marginal distributions">
                {#each Array(9) as _, i}
                    <circle class="marg-mean" cx={xstart + direct_mu.get(i*2,0)*scale} cy={ystart + direct_mu.get(i*2+1,0)*scale} r=3/>
                    <!-- <circle class="marg-std" fill="url(#marg_cov_gradient)" cx={xstart + direct_mu.get(i*2,0)*scale} cy={ystart + direct_mu.get(i*2+1,0)*scale} r={direct_stds[2*i]*scale}/> -->
                    <circle class="marg-std" style="opacity: 1;" fill="none" cx={xstart + direct_mu.get(i*2,0)*scale} cy={ystart + direct_mu.get(i*2+1,0)*scale} r={direct_stds[2*i]*scale*frac_std}/>
                {/each}
            </g>

            <g id="beliefs">
                {#each Array(9) as _, i}
                    <circle class="belief-mean" cx={xstart + means[Math.floor(t)].xs[i]*scale} cy={ystart + means[Math.floor(t)].ys[i]*scale} r=3/>
                    <circle class="belief-std" fill="url(#belief_cov_gradient)" cx={xstart + means[Math.floor(t)].xs[i]*scale} cy={ystart + means[Math.floor(t)].ys[i]*scale} r={stds[Math.floor(t)][i]*scale*frac_std}/>
                    <!-- <circle class="belief-std" fill="none" cx={xstart + means[Math.floor(t)].xs[i]*scale} cy={ystart + means[Math.floor(t)].ys[i]*scale} r={stds[Math.floor(t)][i]*scale*frac_std}/> -->
                {/each}
            </g>

            <g id="key">
                <path id="Belief" d="M394.008 35V24.976H397.634C398.427 24.976 399.109 25.2373 399.678 25.76C400.247 26.2733 400.532 26.922 400.532 27.706C400.532 28.6953 400.079 29.3907 399.174 29.792V29.848C399.687 30.016 400.098 30.31 400.406 30.73C400.714 31.1407 400.868 31.612 400.868 32.144C400.868 32.9653 400.569 33.6467 399.972 34.188C399.393 34.7293 398.679 35 397.83 35H394.008ZM395.296 26.208V29.274H397.634C398.091 29.274 398.474 29.12 398.782 28.812C399.09 28.4947 399.244 28.1353 399.244 27.734C399.244 27.342 399.095 26.9873 398.796 26.67C398.497 26.362 398.129 26.208 397.69 26.208H395.296ZM395.296 30.478V33.768H397.886C398.353 33.768 398.749 33.6047 399.076 33.278C399.393 32.9513 399.552 32.564 399.552 32.116C399.552 31.6773 399.389 31.2947 399.062 30.968C398.735 30.6413 398.325 30.478 397.83 30.478H395.296ZM405.177 35.224C404.169 35.224 403.338 34.8787 402.685 34.188C402.031 33.4973 401.705 32.6247 401.705 31.57C401.705 30.5247 402.022 29.6567 402.657 28.966C403.291 28.266 404.103 27.916 405.093 27.916C406.11 27.916 406.917 28.2473 407.515 28.91C408.121 29.5633 408.425 30.4827 408.425 31.668L408.411 31.808H403.021C403.039 32.48 403.263 33.0213 403.693 33.432C404.122 33.8427 404.635 34.048 405.233 34.048C406.054 34.048 406.698 33.6373 407.165 32.816L408.312 33.376C408.005 33.9547 407.575 34.4073 407.025 34.734C406.483 35.0607 405.867 35.224 405.177 35.224ZM403.119 30.744H407.053C407.015 30.268 406.819 29.876 406.465 29.568C406.119 29.2507 405.653 29.092 405.065 29.092C404.579 29.092 404.159 29.2413 403.805 29.54C403.459 29.8387 403.231 30.24 403.119 30.744ZM410.89 24.976V35H409.602V24.976H410.89ZM414.126 25.774C414.126 26.026 414.037 26.2407 413.86 26.418C413.682 26.5953 413.468 26.684 413.216 26.684C412.964 26.684 412.749 26.5953 412.572 26.418C412.394 26.2407 412.306 26.026 412.306 25.774C412.306 25.522 412.394 25.3073 412.572 25.13C412.749 24.9527 412.964 24.864 413.216 24.864C413.468 24.864 413.682 24.9527 413.86 25.13C414.037 25.3073 414.126 25.522 414.126 25.774ZM413.86 28.14V35H412.572V28.14H413.86ZM418.548 35.224C417.54 35.224 416.709 34.8787 416.056 34.188C415.402 33.4973 415.076 32.6247 415.076 31.57C415.076 30.5247 415.393 29.6567 416.028 28.966C416.662 28.266 417.474 27.916 418.464 27.916C419.481 27.916 420.288 28.2473 420.886 28.91C421.492 29.5633 421.796 30.4827 421.796 31.668L421.782 31.808H416.392C416.41 32.48 416.634 33.0213 417.064 33.432C417.493 33.8427 418.006 34.048 418.604 34.048C419.425 34.048 420.069 33.6373 420.536 32.816L421.684 33.376C421.376 33.9547 420.946 34.4073 420.396 34.734C419.854 35.0607 419.238 35.224 418.548 35.224ZM416.49 30.744H420.424C420.386 30.268 420.19 29.876 419.836 29.568C419.49 29.2507 419.024 29.092 418.436 29.092C417.95 29.092 417.53 29.2413 417.176 29.54C416.83 29.8387 416.602 30.24 416.49 30.744ZM426.001 24.864C426.467 24.864 426.85 24.9433 427.149 25.102L426.799 26.236C426.575 26.124 426.323 26.068 426.043 26.068C425.725 26.068 425.464 26.18 425.259 26.404C425.063 26.6187 424.965 26.908 424.965 27.272V28.14H426.757V29.316H424.965V35H423.677V29.316H422.389V28.14H423.677V27.146C423.677 26.4647 423.891 25.914 424.321 25.494C424.759 25.074 425.319 24.864 426.001 24.864Z" fill="black"/>
                <path id="True marginal distribution" d="M396.424 77.208V86H395.136V77.208H392.336V75.976H399.224V77.208H396.424ZM400.799 86H399.511V79.14H400.743V80.26H400.799C400.929 79.896 401.195 79.588 401.597 79.336C402.007 79.0747 402.409 78.944 402.801 78.944C403.174 78.944 403.491 79 403.753 79.112L403.361 80.358C403.202 80.2927 402.95 80.26 402.605 80.26C402.119 80.26 401.695 80.456 401.331 80.848C400.976 81.24 400.799 81.6973 400.799 82.22V86ZM410.617 86H409.385V85.048H409.329C409.133 85.384 408.829 85.664 408.419 85.888C408.017 86.112 407.597 86.224 407.159 86.224C406.319 86.224 405.67 85.986 405.213 85.51C404.765 85.0247 404.541 84.3387 404.541 83.452V79.14H405.829V83.368C405.857 84.488 406.421 85.048 407.523 85.048C408.036 85.048 408.465 84.8427 408.811 84.432C409.156 84.012 409.329 83.5127 409.329 82.934V79.14H410.617V86ZM415.196 86.224C414.188 86.224 413.357 85.8787 412.704 85.188C412.051 84.4973 411.724 83.6247 411.724 82.57C411.724 81.5247 412.041 80.6567 412.676 79.966C413.311 79.266 414.123 78.916 415.112 78.916C416.129 78.916 416.937 79.2473 417.534 79.91C418.141 80.5633 418.444 81.4827 418.444 82.668L418.43 82.808H413.04C413.059 83.48 413.283 84.0213 413.712 84.432C414.141 84.8427 414.655 85.048 415.252 85.048C416.073 85.048 416.717 84.6373 417.184 83.816L418.332 84.376C418.024 84.9547 417.595 85.4073 417.044 85.734C416.503 86.0607 415.887 86.224 415.196 86.224ZM413.138 81.744H417.072C417.035 81.268 416.839 80.876 416.484 80.568C416.139 80.2507 415.672 80.092 415.084 80.092C414.599 80.092 414.179 80.2413 413.824 80.54C413.479 80.8387 413.25 81.24 413.138 81.744ZM423.986 86H422.698V79.14H423.93V80.092H423.986C424.182 79.756 424.481 79.476 424.882 79.252C425.293 79.028 425.699 78.916 426.1 78.916C426.604 78.916 427.047 79.0327 427.43 79.266C427.813 79.4993 428.093 79.8213 428.27 80.232C428.839 79.3547 429.628 78.916 430.636 78.916C431.429 78.916 432.041 79.1587 432.47 79.644C432.899 80.1293 433.114 80.82 433.114 81.716V86H431.826V81.912C431.826 81.268 431.709 80.806 431.476 80.526C431.243 80.2367 430.851 80.092 430.3 80.092C429.805 80.092 429.39 80.302 429.054 80.722C428.718 81.142 428.55 81.6367 428.55 82.206V86H427.262V81.912C427.262 81.268 427.145 80.806 426.912 80.526C426.679 80.2367 426.287 80.092 425.736 80.092C425.241 80.092 424.826 80.302 424.49 80.722C424.154 81.142 423.986 81.6367 423.986 82.206V86ZM435.49 83.9C435.49 84.236 435.63 84.516 435.91 84.74C436.199 84.964 436.535 85.076 436.918 85.076C437.459 85.076 437.94 84.8753 438.36 84.474C438.789 84.0727 439.004 83.6013 439.004 83.06C438.602 82.7427 438.042 82.584 437.324 82.584C436.801 82.584 436.362 82.71 436.008 82.962C435.662 83.214 435.49 83.5267 435.49 83.9ZM437.156 78.916C438.108 78.916 438.859 79.1727 439.41 79.686C439.96 80.19 440.236 80.8853 440.236 81.772V86H439.004V85.048H438.948C438.416 85.832 437.706 86.224 436.82 86.224C436.064 86.224 435.429 86 434.916 85.552C434.412 85.104 434.16 84.544 434.16 83.872C434.16 83.1627 434.426 82.598 434.958 82.178C435.499 81.758 436.218 81.548 437.114 81.548C437.879 81.548 438.509 81.688 439.004 81.968V81.674C439.004 81.226 438.826 80.848 438.472 80.54C438.117 80.2227 437.702 80.064 437.226 80.064C436.507 80.064 435.938 80.3673 435.518 80.974L434.384 80.26C435.009 79.364 435.933 78.916 437.156 78.916ZM442.976 86H441.688V79.14H442.92V80.26H442.976C443.107 79.896 443.373 79.588 443.774 79.336C444.185 79.0747 444.586 78.944 444.978 78.944C445.352 78.944 445.669 79 445.93 79.112L445.538 80.358C445.38 80.2927 445.128 80.26 444.782 80.26C444.297 80.26 443.872 80.456 443.508 80.848C443.154 81.24 442.976 81.6973 442.976 82.22V86ZM449.499 85.048C450.133 85.048 450.651 84.8193 451.053 84.362C451.473 83.9047 451.683 83.3073 451.683 82.57C451.683 81.8513 451.473 81.2587 451.053 80.792C450.642 80.3253 450.124 80.092 449.499 80.092C448.883 80.092 448.365 80.3253 447.945 80.792C447.525 81.2587 447.315 81.8513 447.315 82.57C447.315 83.298 447.525 83.8907 447.945 84.348C448.365 84.8147 448.883 85.048 449.499 85.048ZM449.457 89.248C449.074 89.248 448.715 89.1967 448.379 89.094C448.043 89.0007 447.735 88.8653 447.455 88.688C447.184 88.5107 446.951 88.3007 446.755 88.058C446.559 87.8153 446.409 87.5447 446.307 87.246L447.525 86.742C447.665 87.1433 447.907 87.4653 448.253 87.708C448.598 87.9507 448.999 88.072 449.457 88.072C450.157 88.072 450.703 87.862 451.095 87.442C451.487 87.022 451.683 86.4433 451.683 85.706V85.048H451.627C451.384 85.412 451.053 85.7013 450.633 85.916C450.222 86.1213 449.774 86.224 449.289 86.224C448.393 86.224 447.623 85.874 446.979 85.174C446.344 84.4553 446.027 83.5873 446.027 82.57C446.027 81.5527 446.344 80.6893 446.979 79.98C447.623 79.2707 448.393 78.916 449.289 78.916C449.774 78.916 450.222 79.0233 450.633 79.238C451.053 79.4433 451.384 79.728 451.627 80.092H451.683V79.14H452.915V85.706C452.915 86.8073 452.602 87.6707 451.977 88.296C451.342 88.9307 450.502 89.248 449.457 89.248ZM456.151 76.774C456.151 77.026 456.063 77.2407 455.885 77.418C455.708 77.5953 455.493 77.684 455.241 77.684C454.989 77.684 454.775 77.5953 454.597 77.418C454.42 77.2407 454.331 77.026 454.331 76.774C454.331 76.522 454.42 76.3073 454.597 76.13C454.775 75.9527 454.989 75.864 455.241 75.864C455.493 75.864 455.708 75.9527 455.885 76.13C456.063 76.3073 456.151 76.522 456.151 76.774ZM455.885 79.14V86H454.597V79.14H455.885ZM457.561 79.14H458.793V80.092H458.849C459.045 79.756 459.344 79.476 459.745 79.252C460.156 79.028 460.581 78.916 461.019 78.916C461.859 78.916 462.503 79.1587 462.951 79.644C463.409 80.12 463.637 80.8013 463.637 81.688V86H462.349V81.772C462.321 80.652 461.757 80.092 460.655 80.092C460.142 80.092 459.713 80.302 459.367 80.722C459.022 81.1327 458.849 81.6273 458.849 82.206V86H457.561V79.14ZM466.019 83.9C466.019 84.236 466.159 84.516 466.439 84.74C466.728 84.964 467.064 85.076 467.447 85.076C467.988 85.076 468.469 84.8753 468.889 84.474C469.318 84.0727 469.533 83.6013 469.533 83.06C469.132 82.7427 468.572 82.584 467.853 82.584C467.33 82.584 466.892 82.71 466.537 82.962C466.192 83.214 466.019 83.5267 466.019 83.9ZM467.685 78.916C468.637 78.916 469.388 79.1727 469.939 79.686C470.49 80.19 470.765 80.8853 470.765 81.772V86H469.533V85.048H469.477C468.945 85.832 468.236 86.224 467.349 86.224C466.593 86.224 465.958 86 465.445 85.552C464.941 85.104 464.689 84.544 464.689 83.872C464.689 83.1627 464.955 82.598 465.487 82.178C466.028 81.758 466.747 81.548 467.643 81.548C468.408 81.548 469.038 81.688 469.533 81.968V81.674C469.533 81.226 469.356 80.848 469.001 80.54C468.646 80.2227 468.231 80.064 467.755 80.064C467.036 80.064 466.467 80.3673 466.047 80.974L464.913 80.26C465.538 79.364 466.462 78.916 467.685 78.916ZM473.506 75.976V86H472.218V75.976H473.506ZM395.864 102.048C396.499 102.048 397.017 101.819 397.418 101.362C397.838 100.905 398.048 100.307 398.048 99.57C398.048 98.8513 397.838 98.2587 397.418 97.792C397.007 97.3253 396.489 97.092 395.864 97.092C395.248 97.092 394.73 97.3253 394.31 97.792C393.89 98.2587 393.68 98.8513 393.68 99.57C393.68 100.298 393.89 100.891 394.31 101.348C394.73 101.815 395.248 102.048 395.864 102.048ZM395.654 103.224C394.758 103.224 393.988 102.869 393.344 102.16C392.709 101.441 392.392 100.578 392.392 99.57C392.392 98.562 392.709 97.6987 393.344 96.98C393.988 96.2707 394.758 95.916 395.654 95.916C396.158 95.916 396.615 96.0233 397.026 96.238C397.446 96.4527 397.768 96.7373 397.992 97.092H398.048L397.992 96.14V92.976H399.28V103H398.048V102.048H397.992C397.768 102.403 397.446 102.687 397.026 102.902C396.615 103.117 396.158 103.224 395.654 103.224ZM402.516 93.774C402.516 94.026 402.428 94.2407 402.25 94.418C402.073 94.5953 401.858 94.684 401.606 94.684C401.354 94.684 401.14 94.5953 400.962 94.418C400.785 94.2407 400.696 94.026 400.696 93.774C400.696 93.522 400.785 93.3073 400.962 93.13C401.14 92.9527 401.354 92.864 401.606 92.864C401.858 92.864 402.073 92.9527 402.25 93.13C402.428 93.3073 402.516 93.522 402.516 93.774ZM402.25 96.14V103H400.962V96.14H402.25ZM409.177 101.096C409.177 101.693 408.915 102.197 408.393 102.608C407.87 103.019 407.212 103.224 406.419 103.224C405.728 103.224 405.121 103.047 404.599 102.692C404.076 102.328 403.703 101.852 403.479 101.264L404.627 100.774C404.795 101.185 405.037 101.507 405.355 101.74C405.681 101.964 406.036 102.076 406.419 102.076C406.829 102.076 407.17 101.987 407.441 101.81C407.721 101.633 407.861 101.423 407.861 101.18C407.861 100.741 407.525 100.419 406.853 100.214L405.677 99.92C404.342 99.584 403.675 98.94 403.675 97.988C403.675 97.3627 403.927 96.8633 404.431 96.49C404.944 96.1073 405.597 95.916 406.391 95.916C406.997 95.916 407.543 96.0607 408.029 96.35C408.523 96.6393 408.869 97.0267 409.065 97.512L407.917 97.988C407.786 97.6987 407.571 97.4747 407.273 97.316C406.983 97.148 406.657 97.064 406.293 97.064C405.957 97.064 405.653 97.148 405.383 97.316C405.121 97.484 404.991 97.6893 404.991 97.932C404.991 98.324 405.359 98.604 406.097 98.772L407.133 99.038C408.495 99.374 409.177 100.06 409.177 101.096ZM412.945 103.112C412.385 103.112 411.919 102.939 411.545 102.594C411.181 102.249 410.995 101.768 410.985 101.152V97.316H409.781V96.14H410.985V94.04H412.273V96.14H413.953V97.316H412.273V100.732C412.273 101.189 412.362 101.502 412.539 101.67C412.717 101.829 412.917 101.908 413.141 101.908C413.244 101.908 413.342 101.899 413.435 101.88C413.538 101.852 413.631 101.819 413.715 101.782L414.121 102.93C413.785 103.051 413.393 103.112 412.945 103.112ZM416.467 103H415.179V96.14H416.411V97.26H416.467C416.597 96.896 416.863 96.588 417.265 96.336C417.675 96.0747 418.077 95.944 418.469 95.944C418.842 95.944 419.159 96 419.421 96.112L419.029 97.358C418.87 97.2927 418.618 97.26 418.273 97.26C417.787 97.26 417.363 97.456 416.999 97.848C416.644 98.24 416.467 98.6973 416.467 99.22V103ZM421.93 93.774C421.93 94.026 421.842 94.2407 421.664 94.418C421.487 94.5953 421.272 94.684 421.02 94.684C420.768 94.684 420.554 94.5953 420.376 94.418C420.199 94.2407 420.11 94.026 420.11 93.774C420.11 93.522 420.199 93.3073 420.376 93.13C420.554 92.9527 420.768 92.864 421.02 92.864C421.272 92.864 421.487 92.9527 421.664 93.13C421.842 93.3073 421.93 93.522 421.93 93.774ZM421.664 96.14V103H420.376V96.14H421.664ZM426.967 103.224C426.463 103.224 426.001 103.117 425.581 102.902C425.17 102.687 424.853 102.403 424.629 102.048H424.573V103H423.341V92.976H424.629V96.14L424.573 97.092H424.629C424.853 96.7373 425.17 96.4527 425.581 96.238C426.001 96.0233 426.463 95.916 426.967 95.916C427.872 95.916 428.637 96.2707 429.263 96.98C429.907 97.6987 430.229 98.562 430.229 99.57C430.229 100.587 429.907 101.451 429.263 102.16C428.637 102.869 427.872 103.224 426.967 103.224ZM426.757 102.048C427.373 102.048 427.891 101.815 428.311 101.348C428.731 100.891 428.941 100.298 428.941 99.57C428.941 98.8513 428.731 98.2587 428.311 97.792C427.891 97.3253 427.373 97.092 426.757 97.092C426.131 97.092 425.609 97.3253 425.189 97.792C424.778 98.2587 424.573 98.8513 424.573 99.57C424.573 100.298 424.778 100.895 425.189 101.362C425.609 101.819 426.131 102.048 426.757 102.048ZM437.359 103H436.127V102.048H436.071C435.875 102.384 435.571 102.664 435.161 102.888C434.759 103.112 434.339 103.224 433.901 103.224C433.061 103.224 432.412 102.986 431.955 102.51C431.507 102.025 431.283 101.339 431.283 100.452V96.14H432.571V100.368C432.599 101.488 433.163 102.048 434.265 102.048C434.778 102.048 435.207 101.843 435.553 101.432C435.898 101.012 436.071 100.513 436.071 99.934V96.14H437.359V103ZM441.711 103.112C441.151 103.112 440.684 102.939 440.311 102.594C439.947 102.249 439.76 101.768 439.751 101.152V97.316H438.547V96.14H439.751V94.04H441.039V96.14H442.719V97.316H441.039V100.732C441.039 101.189 441.128 101.502 441.305 101.67C441.482 101.829 441.683 101.908 441.907 101.908C442.01 101.908 442.108 101.899 442.201 101.88C442.304 101.852 442.397 101.819 442.481 101.782L442.887 102.93C442.551 103.051 442.159 103.112 441.711 103.112ZM445.679 93.774C445.679 94.026 445.59 94.2407 445.413 94.418C445.235 94.5953 445.021 94.684 444.769 94.684C444.517 94.684 444.302 94.5953 444.125 94.418C443.947 94.2407 443.859 94.026 443.859 93.774C443.859 93.522 443.947 93.3073 444.125 93.13C444.302 92.9527 444.517 92.864 444.769 92.864C445.021 92.864 445.235 92.9527 445.413 93.13C445.59 93.3073 445.679 93.522 445.679 93.774ZM445.413 96.14V103H444.125V96.14H445.413ZM446.628 99.57C446.628 98.5153 446.96 97.6427 447.622 96.952C448.294 96.2613 449.139 95.916 450.156 95.916C451.174 95.916 452.014 96.2613 452.676 96.952C453.348 97.6427 453.684 98.5153 453.684 99.57C453.684 100.634 453.348 101.507 452.676 102.188C452.014 102.879 451.174 103.224 450.156 103.224C449.139 103.224 448.294 102.879 447.622 102.188C446.96 101.497 446.628 100.625 446.628 99.57ZM447.916 99.57C447.916 100.307 448.131 100.905 448.56 101.362C448.99 101.819 449.522 102.048 450.156 102.048C450.791 102.048 451.323 101.819 451.752 101.362C452.182 100.905 452.396 100.307 452.396 99.57C452.396 98.842 452.182 98.2493 451.752 97.792C451.314 97.3253 450.782 97.092 450.156 97.092C449.531 97.092 448.999 97.3253 448.56 97.792C448.131 98.2493 447.916 98.842 447.916 99.57ZM454.718 96.14H455.95V97.092H456.006C456.202 96.756 456.5 96.476 456.902 96.252C457.312 96.028 457.737 95.916 458.176 95.916C459.016 95.916 459.66 96.1587 460.108 96.644C460.565 97.12 460.794 97.8013 460.794 98.688V103H459.506V98.772C459.478 97.652 458.913 97.092 457.812 97.092C457.298 97.092 456.869 97.302 456.524 97.722C456.178 98.1327 456.006 98.6273 456.006 99.206V103H454.718V96.14Z" fill="black"/>

                <circle class="belief-mean" cx=365 cy=30 r=3/>
                <circle class="belief-std" fill="url(#belief_cov_gradient)" cx=365 cy=30 r=17/>
                <circle class="marg-mean" cx=365 cy=90 r=3/>
                <!-- <circle class="marg-std" fill="url(#marg_cov_gradient)" cx=365 cy=90 r=17/> -->
                <circle class="marg-std" fill="none" cx=365 cy=90 r=17/>
            </g>

            <defs>
                <radialGradient id="belief_cov_gradient">
                    <stop offset="0.35" stop-color="rgb(0,0,250)" stop-opacity="0.5" />
                    <stop offset="1" stop-color="#D3D3D3" stop-opacity="0.25" />
                </radialGradient>
                <radialGradient id="marg_cov_gradient">
                    <stop offset="0.35" stop-color="rgb(0,140,0)" stop-opacity="0.5" />
                    <stop offset="1" stop-color="#D3D3D3" stop-opacity="0.25" />
                </radialGradient>
            </defs>
        </svg>

    </div>
    
    <figcaption style="text-align: center;">
        Move the slider to progress through GBP message passing (MP). Note that the top left node is anchored by a strong prior.
    </figcaption>

</figure>